<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CA Automation App</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: #f5f5f5; color: #333; }
    .container { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
    h1 { margin-bottom: 1.5rem; color: #1a73e8; }
    .status { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .status.loading { opacity: 0.6; }
    .error { color: #d32f2f; background: #ffebee; padding: 1rem; border-radius: 4px; border-left: 4px solid #d32f2f; }
    .success { color: #1b5e20; background: #e8f5e9; padding: 1rem; border-radius: 4px; border-left: 4px solid #4caf50; }
    ul { list-style: none; }
    li { background: white; padding: 1rem; margin-bottom: 0.5rem; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .tag { display: inline-block; background: #e0e0e0; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; margin-left: 0.5rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìã CA Automation App</h1>
    
    <div id="status" class="status loading">Connecting to backend...</div>
    
    <div>
      <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Tasks</h2>
      <ul id="tasks"></ul>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:4000/api';
    const statusEl = document.getElementById('status');
    const tasksEl = document.getElementById('tasks');

    async function loadTasks() {
      try {
        // Check backend health
        const healthRes = await fetch(`${API_URL}/health`);
        const health = await healthRes.json();
        
        if (health.status === 'ok') {
          statusEl.className = 'success';
          statusEl.textContent = '‚úÖ Backend connected';
        }

        // Load tasks
        const tasksRes = await fetch(`${API_URL}/tasks`);
        const data = await tasksRes.json();
        
        tasksEl.innerHTML = '';
        if (data.tasks && data.tasks.length > 0) {
          data.tasks.forEach(task => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${task.title}</strong><span class="tag">${task.status}</span>`;
            tasksEl.appendChild(li);
          });
        } else {
          tasksEl.innerHTML = '<li><em>No tasks available</em></li>';
        }
      } catch (error) {
        statusEl.className = 'error';
        statusEl.textContent = `‚ùå Error: ${error.message}. Make sure backend is running on port 4000.`;
        console.error('Frontend error:', error);
      }
    }

    // Load tasks when page loads
    loadTasks();
    // Refresh every 5 seconds
    setInterval(loadTasks, 5000);
  </script>
</body>
</html>
